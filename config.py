from pypinyin import lazy_pinyin


SMTP_SERVER = "smtp.gmail.com"
SMTP_PORT = 587
SENDER_EMAIL = "dhly1518194984@gmail.com"  # 你的发件邮箱
SENDER_PASSWORD = "mwcp goig swfo xrfr" # 你的应用专用密码 (16位)

# ================= 1. 标准武将名列表 (Data Source) =================
# 按势力分类整理，方便维护。程序运行时会视为一个大列表。

WEI_GENERALS = [
    "曹操", "司马懿", "夏侯惇", "张辽", "许褚", "郭嘉", "甄姬", # 魏标
    "夏侯渊", "张郃", "徐晃", "曹仁", # 魏阵
    "典韦", "荀彧", "曹丕", # 魏势
    "李典", "乐进", "臧霸", # 魏变
    "邓艾", "崔毛", "荀攸", "卞夫人",  # 魏权/其他
    "李典", "曹洪", "于禁",
]

SHU_GENERALS = [
    "刘备", "关羽", "张飞", "诸葛亮", "赵云", "马超", "黄忠", # 蜀标
    "魏延", "庞统", "卧龙诸葛", "姜维", # 蜀阵
    "刘禅", "甘夫人", "蒋费", "法正", # 蜀势
    "马岱", # 蜀变
    "祝融", "孟获", "沙摩柯", "王平", # 蜀权/其他
    "黄月英", "糜夫人", "马谡"
]

WU_GENERALS = [
    "孙权", "甘宁", "吕蒙", "黄盖", "周瑜", "大乔", "陆逊", "孙尚香", # 吴标
    "孙坚", "小乔", "太史慈", "周泰", # 吴阵
    "鲁肃", "孙策", "二张", # 吴势 (张昭张弘)
    "徐盛", "丁奉", "凌统", # 吴变
    "蒋钦", "陈武董袭", "吴国太", "吕范", "陆抗" # 吴权/其他
]

QUN_GENERALS = [
    "华佗", "吕布", "貂蝉", "袁绍", # 群标
    "颜良文丑", "贾诩", "庞德", "张角", # 群阵
    "于吉", "左慈", "蔡文姬", # 群势
    "马腾", "孔融", "纪灵", "田丰", # 群变
    "邹氏", "袁术", "董卓", "潘凤", "张绣", "李傕郭汜", "何太后", "张任" # 群权/其他
]

print(len(WEI_GENERALS), len(SHU_GENERALS), len(WU_GENERALS), len(QUN_GENERALS))
# 合并所有武将为一个主列表
STANDARD_GENERALS = WEI_GENERALS + SHU_GENERALS + WU_GENERALS + QUN_GENERALS

# ================= 2. 昵称映射表 (Alias Map) =================
# Key: 昵称/外号/简称 -> Value: 标准武将名
# 可以在这里随意添加你和小伙伴平时用的叫法

ALIAS_MAP = {
    # === 魏 ===
    "曹老板": "曹操", "孟德": "曹操", "奸雄": "曹操",
    "司马": "司马懿", "老毕灯": "司马懿",
    "刚烈": "夏侯惇", "肛裂": "夏侯惇", "大魏核心": "夏侯惇", "惇惇": "夏侯惇", "惇哥": "夏侯惇",
    "辽神": "张辽", "八百": "张辽",
    "裸衣": "许褚",
    "卖血": "郭嘉", "罢了": "郭嘉", 
    "洛神": "甄姬", "大姨妈": "甄姬",
    "神速": "夏侯渊",
    "巧变": "张郃",
    "断粮": "徐晃",
    "大将军": "曹仁", "八卦": "曹仁",
    "强袭": "典韦",
    "狗货": "荀彧", "令君": "荀彧", "驱虎": "荀彧",
    "太子": "曹丕", "送殡": "曹丕",
    "二五八万": "乐进",
    "屯田": "邓艾", "红桃邓": "邓艾", "邓红桃": "邓艾",
    # "李典": "李典", 
    # "曹洪", 
    # "于禁"


    # === 蜀 ===
    "玄德": "刘备", "皇叔": "刘备", "村长": "刘备", "仁德": "刘备",
    "二爷": "关羽", "武圣": "关羽", "云长": "关羽",
    "三爷": "张飞", "咆哮": "张飞", "翼德": "张飞",
    "丞相": "诸葛亮", "老诸葛": "诸葛亮", "孔明": "诸葛亮", "村夫": "诸葛亮", "诸葛孔明": "诸葛亮",
    "云妹": "赵云", "子龙": "赵云",
    "铁骑": "马超", "全军突击": "马超",
    "烈弓": "黄忠", "老头": "黄忠",
    "狂骨": "魏延",
    "连环": "庞统",
    "火诸葛": "卧龙诸葛", "卧龙": "卧龙诸葛", "小诸葛": "卧龙诸葛",
    "挑衅": "姜维",
    "小胖": "刘禅", 
    "马神": "马岱", "马忠": "马岱", # 喊马神一般指马岱
    "蛮王": "孟获",
    "蛮王妃": "祝融", "巨象": "祝融",
    "老沙": "沙摩柯",
    "蒋琬费祎": "蒋费", "蒋琬": "蒋费", "费祎": "蒋费",


    # === 吴 ===
    "大帝": "孙权", "渣权": "孙权", "孙十万": "孙权", "制衡": "孙权", "吴王": "孙权", "大魏吴王": "孙权",
    "拆迁": "甘宁", "拆迁队": "甘宁",
    "克己": "吕蒙",
    "苦肉": "黄盖", "盖子": "黄盖",
    "大都督": "周瑜", "英姿": "周瑜",
    "方块周": "周瑜",
    "陆神": "陆逊",
    "香香": "孙尚香", "啊香": "孙尚香",
    "猴子": "孙坚",
    "那个男人": "孙策", "江东小霸王": "孙策", "激昂": "孙策", "孙笨": "孙策",
    "大师": "鲁肃", "好施": "鲁肃", "鲁大师": "鲁肃",
    "张昭": "二张", "张弘": "二张", "张昭张弘": "二张", "2张": "二张",
    "大宝": "徐盛", "阴间": "徐盛", "破军": "徐盛", "盛盛": "徐盛", "小宝": "徐盛",
    "僵尸": "周泰", "不屈": "周泰",
    "奋迅": "丁奉",
    "旋风": "凌统",
    "陈武": "陈武董袭", "董袭": "陈武董袭", "陈董": "陈武董袭",

    # === 群 ===
    "青囊": "华佗",
    "温侯": "吕布", "无双": "吕布",
    "闭月": "貂蝉",
    "大嘴": "袁绍", "放箭": "袁绍",
    "双头": "颜良文丑", "双头怪": "颜良文丑", "颜良": "颜良文丑", "文丑": "颜良文丑",
    "完杀": "贾诩", "毒士": "贾诩",
    "抬棺": "庞德", 
    "教主": "张角", "雷公": "张角", "妙脆角": "张角",
    "老骗子": "于吉",
    "化身": "左慈", "仙人": "左慈",
    "毒菜": "蔡文姬", "断肠": "蔡文姬",
    "让梨": "孔融", "名士": "孔融",
    "三尖刀": "纪灵",
    "无双上将": "潘凤",
    "李傕": "李傕郭汜", "郭汜": "李傕郭汜", "李郭": "李傕郭汜",
    "太后": "何太后",
    "义父": "董卓",
    
}

print(len(set(ALIAS_MAP.values())))

# ================= 3. 名称处理逻辑 (Logic) =================

def normalize_name(input_name):
    """
    输入清洗与匹配逻辑：
    1. 去除首尾空格
    2. 检查是否完全匹配标准名
    3. 检查是否在昵称表中
    4. 拼音首字母/全拼模糊匹配
    """
    if not input_name:
        return ""
        
    name = input_name.strip()
    
    # 1. 已经是标准名，直接返回
    if name in STANDARD_GENERALS:
        return name
        
    # 2. 查昵称表
    if name in ALIAS_MAP:
        return ALIAS_MAP[name]
        
    # 3. 拼音匹配 (处理输入 "simayi" 或 "smy" 的情况)
    try:
        input_pinyin_list = lazy_pinyin(name)
        input_full_pinyin = "".join(input_pinyin_list)       # simayi
        input_first_letters = "".join([p[0] for p in input_pinyin_list]) # smy
        
        for std_name in STANDARD_GENERALS: # realname_matching
            std_pinyin_list = lazy_pinyin(std_name)
            std_full_pinyin = "".join(std_pinyin_list)
            std_first_letters = "".join([p[0] for p in std_pinyin_list])
            
            # 全拼匹配 (simayi == simayi)
            if input_full_pinyin == std_full_pinyin:
                return std_name
            
            # # 首字母匹配 (smy == smy)
            # if input_first_letters == std_first_letters:
            #     return std_name

        for nickname, realname in ALIAS_MAP.items():
            std_pinyin_list = lazy_pinyin(nickname)
            std_full_pinyin = "".join(std_pinyin_list)
            std_first_letters = "".join([p[0] for p in std_pinyin_list])
            
            # 全拼匹配 (simayi == simayi)
            if input_full_pinyin == std_full_pinyin:
                return realname
            
            # # 首字母匹配 (smy == smy)
            # if input_first_letters == std_first_letters:
            #     return realname  
        
                
    except Exception:
        pass # 如果拼音库报错，忽略，返回原名
            
    # 如果都匹配不到，返回原输入（避免擅自修改用户可能输入的新武将）
    return name